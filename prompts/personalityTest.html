<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" type="image/png" href="../assets/favicon.png" />
  <title>Pufflings - Personality Test</title>
  <meta name="title" content="Pufflings - Personality Test" />
  <meta name="type" content="website" />
  <meta name="url" content="https://pufflings.github.io/Masterlist/" />
  <meta name="image" content="../assets/meta.png" />
  <meta name="description" content="Welcome to the Puffling ARPG! Pufflings are a mysterious, fluffy creature, believed to be descendants of legendary dragons.">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
  <link rel="stylesheet" type="text/css" href="../styles/css/charadex.css">

  <link rel="stylesheet" type="text/css" href="../styles/css/charadex-story.css">
  <link rel="stylesheet" type="text/css" href="../styles/css/charadex-prompts.css">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400|Comfortaa:500" rel="stylesheet">

  <style>
    /* Quiz Container */
    .quiz-container {
      max-width: 700px;
      margin: 0 auto;
    }

    /* Question Cards */
    .question-card {
      display: none;
      animation: fadeIn 0.4s ease;
    }

    .question-card.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Progress Bar */
    .progress-bar-container {
      margin-bottom: 30px;
    }

    .progress {
      height: 12px;
      background-color: var(--cd-faded-background-color);
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    }

    .progress-bar {
      background: linear-gradient(90deg, var(--cd-secondary-color), var(--cd-link-text-color));
      border-radius: 1rem;
      transition: width 0.4s ease;
    }

    /* Question Styling */
    .question-number {
      font-family: var(--cd-header-font-family);
      font-size: 0.9em;
      color: var(--cd-secondary-color);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .question-text {
      font-family: var(--cd-header-font-family);
      font-size: 1.4em;
      font-weight: 500;
      color: var(--cd-body-text-color);
      margin-bottom: 30px;
      line-height: 1.4;
    }

    /* Option Buttons */
    .options-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .option-btn {
      display: block;
      width: 100%;
      text-align: left;
      padding: 16px 20px;
      border: 2px solid var(--cd-border-color2);
      border-radius: 1rem;
      background: var(--cd-faded-background-color);
      color: var(--cd-body-text-color);
      font-family: var(--cd-body-font-family);
      font-size: 1em;
      cursor: pointer;
      transition: all 0.25s ease;
      position: relative;
      overflow: hidden;
    }

    .option-btn::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background: transparent;
      transition: all 0.25s ease;
    }

    .option-btn:hover {
      border-color: var(--cd-link-text-color);
      background: var(--cd-content-background-color);
      transform: translateX(4px);
    }

    .option-btn:hover::before {
      background: var(--cd-link-text-color);
    }

    .option-btn.selected {
      border-color: var(--cd-secondary-color);
      background: var(--cd-primary-color);
      box-shadow: 0 4px 12px rgba(136, 119, 101, 0.3);
    }

    .option-btn.selected::before {
      background: var(--cd-secondary-color);
      width: 6px;
    }

    /* Navigation Buttons */
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 35px;
      padding-top: 20px;
      border-top: 1px dashed var(--cd-border-color);
    }

    .nav-buttons .btn {
      min-width: 120px;
      padding: 12px 24px;
      font-family: var(--cd-header-font-family);
    }

    .nav-buttons .btn-outline-secondary {
      border-color: var(--cd-secondary-color);
      color: var(--cd-secondary-color);
    }

    .nav-buttons .btn-outline-secondary:hover:not(:disabled) {
      background: var(--cd-secondary-color);
      color: var(--cd-faded-background-color);
    }

    .nav-buttons .btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    /* Introduction Section */
    #intro-section {
      padding: 20px 0;
    }

    #intro-section p {
      font-size: 1.1em;
      line-height: 1.7;
      color: var(--cd-body-text-color);
    }

    #start-btn {
      margin-top: 20px;
      padding: 15px 40px;
      font-size: 1.1em;
      font-family: var(--cd-header-font-family);
      letter-spacing: 0.5px;
    }

    /* Results Container */
    .result-container {
      display: none;
      text-align: center;
      animation: fadeIn 0.5s ease;
    }

    .result-container.active {
      display: block;
    }

    .result-container h4 {
      font-size: 1.2em;
      color: var(--cd-secondary-color);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    /* Element Result Display */
    .element-result {
      font-family: var(--cd-header-font-family);
      font-size: 3em;
      font-weight: bold;
      margin: 25px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    .result-description {
      font-size: 1.15em;
      line-height: 1.6;
      max-width: 500px;
      margin: 0 auto 30px;
      color: var(--cd-body-text-color);
    }

    /* Element Colors - Warm palette that fits the site */
    .element-fire { color: #c44536; }
    .element-earth { color: #6b5344; }
    .element-water { color: #3d7ea6; }
    .element-air { color: #7ba7bc; }
    .element-light { color: #d4a03c; }
    .element-darkness { color: #5c4a72; }

    /* Element background colors for result card */
    .result-card {
      padding: 30px;
      border-radius: 1rem;
      margin: 20px 0;
    }

    .result-card.fire { background: linear-gradient(135deg, rgba(196, 69, 54, 0.1), rgba(196, 69, 54, 0.05)); border: 2px solid rgba(196, 69, 54, 0.3); }
    .result-card.earth { background: linear-gradient(135deg, rgba(107, 83, 68, 0.1), rgba(107, 83, 68, 0.05)); border: 2px solid rgba(107, 83, 68, 0.3); }
    .result-card.water { background: linear-gradient(135deg, rgba(61, 126, 166, 0.1), rgba(61, 126, 166, 0.05)); border: 2px solid rgba(61, 126, 166, 0.3); }
    .result-card.air { background: linear-gradient(135deg, rgba(123, 167, 188, 0.1), rgba(123, 167, 188, 0.05)); border: 2px solid rgba(123, 167, 188, 0.3); }
    .result-card.light { background: linear-gradient(135deg, rgba(212, 160, 60, 0.1), rgba(212, 160, 60, 0.05)); border: 2px solid rgba(212, 160, 60, 0.3); }
    .result-card.darkness { background: linear-gradient(135deg, rgba(92, 74, 114, 0.1), rgba(92, 74, 114, 0.05)); border: 2px solid rgba(92, 74, 114, 0.3); }

    /* Score Breakdown */
    .score-breakdown {
      text-align: left;
      max-width: 450px;
      margin: 30px auto;
      padding: 25px;
      background: var(--cd-faded-background-color);
      border-radius: 1rem;
      border: 1px solid var(--cd-border-color);
    }

    .score-breakdown h6 {
      font-family: var(--cd-header-font-family);
      color: var(--cd-secondary-color);
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 0.9em;
    }

    .score-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px dashed var(--cd-border-color);
    }

    .score-row:last-child {
      border-bottom: none;
    }

    .score-row span:first-child {
      font-weight: 500;
      font-size: 1.05em;
    }

    .score-row span:last-child {
      color: var(--cd-secondary-color);
      font-family: var(--cd-header-font-family);
    }

    /* Score bar visualization */
    .score-bar-container {
      flex: 1;
      margin: 0 15px;
      height: 8px;
      background: var(--cd-content-background-color);
      border-radius: 4px;
      overflow: hidden;
    }

    .score-bar {
      height: 100%;
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    .score-bar.fire { background: #c44536; }
    .score-bar.earth { background: #6b5344; }
    .score-bar.water { background: #3d7ea6; }
    .score-bar.air { background: #7ba7bc; }
    .score-bar.light { background: #d4a03c; }
    .score-bar.darkness { background: #5c4a72; }

    /* Restart Button */
    #restart-btn {
      margin-top: 25px;
      padding: 12px 30px;
      font-family: var(--cd-header-font-family);
      border-color: var(--cd-secondary-color);
      color: var(--cd-secondary-color);
    }

    #restart-btn:hover {
      background: var(--cd-secondary-color);
      color: var(--cd-faded-background-color);
    }

    /* Mobile Responsiveness */
    @media (max-width: 576px) {
      .question-text {
        font-size: 1.2em;
      }

      .option-btn {
        padding: 14px 16px;
        font-size: 0.95em;
      }

      .element-result {
        font-size: 2.2em;
      }

      .nav-buttons .btn {
        min-width: 100px;
        padding: 10px 18px;
      }
    }
  </style>
</head>
<body id="charadex-body">
  <div class="load-html" id="header" data-source="../includes/header.html"></div>
  <div class="container" id="main-container">
    <div id="charadex-gallery">
      <!-- Top Card Container -->
      <div class="card p-md-5 p-4 mb-4">
        <!-- Title -->
        <h3 class="mb-0"><a href="personalityTest.html">Elemental Personality Test</a></h3>
        <h6><i>Discover your elemental affinity</i></h6>
        <hr>
        <div class="text-justify my-4">

          <!-- Introduction -->
          <div id="intro-section" class="text-center">
            <p>Placeholder introduction text. Explain what this personality test is about and what the user will discover.</p>
            <p>There are 16 questions. Answer honestly to find out which element you are most aligned with!</p>
            <br>
            <button id="start-btn" class="btn btn-primary btn-lg">Begin the Test</button>
          </div>

          <!-- Quiz Container -->
          <div id="quiz-container" class="quiz-container" style="display: none;">

            <!-- Progress Bar -->
            <div class="progress-bar-container">
              <div class="progress">
                <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
              </div>
            </div>

            <!-- Questions will be generated here -->
            <div id="questions-container"></div>

            <!-- Navigation Buttons -->
            <div class="nav-buttons">
              <button id="prev-btn" class="btn btn-outline-secondary" disabled>Previous</button>
              <button id="next-btn" class="btn btn-primary" disabled>Next</button>
            </div>
          </div>

          <!-- Results Container -->
          <div id="result-container" class="result-container">
            <h4>Your Elemental Affinity</h4>

            <div id="result-card" class="result-card">
              <div id="result-element" class="element-result"></div>
              <p id="result-description" class="result-description"></p>
            </div>

            <div class="score-breakdown">
              <h6>Score Breakdown</h6>
              <div id="score-details"></div>
            </div>

            <button id="restart-btn" class="btn btn-outline-primary">Take the Test Again</button>
          </div>

        </div>
        <hr>
      </div>
      <!-- Content List -->
      <div class="row no-gutters charadex-shop-list softload m-n2"></div>
    </div>
  </div>
  <div class="load-html" id="footer" data-source="../includes/footer.html"></div>

  <!-- Floating Scroll to Top Button -->
   <button id="scroll-to-top" class="btn btn-primary" title="Scroll to top">
    â†‘
  </button>

  <script src="https://code.jquery.com/jquery-3.6.0.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
  <script src="../styles/js/pages/base.js" type="module"></script>

  <script>
    // Personality Test Configuration
    const elements = ['fire', 'earth', 'water', 'air', 'light', 'darkness'];

    // Point multipliers based on question number
    // Questions 4, 5, 7, 11, 15, 16: +2 points
    // Questions 2, 6, 9, 13: +1.5 points
    // Questions 1, 3, 8, 10, 12, 14: +1 point
    const questionWeights = {
      1: 1, 2: 1.5, 3: 1, 4: 2, 5: 2, 6: 1.5, 7: 2, 8: 1,
      9: 1.5, 10: 1, 11: 2, 12: 1, 13: 1.5, 14: 1, 15: 2, 16: 2
    };

    // Tiebreaker question number
    const tiebreakerQuestion = 15;

    // Questions data - placeholder text for you to edit
    // Each question has 6 options, one for each element in order: fire, earth, water, air, light, darkness
    const questions = [
      {
        id: 1,
        text: "Placeholder question 1?",
        options: [
          { text: "Option A (Fire answer)", element: "fire" },
          { text: "Option B (Earth answer)", element: "earth" },
          { text: "Option C (Water answer)", element: "water" },
          { text: "Option D (Air answer)", element: "air" },
          { text: "Option E (Light answer)", element: "light" },
          { text: "Option F (Darkness answer)", element: "darkness" }
        ]
      },
      {
        id: 2,
        text: "Placeholder question 2?",
        options: [
          { text: "Option A (Fire answer)", element: "fire" },
          { text: "Option B (Earth answer)", element: "earth" },
          { text: "Option C (Water answer)", element: "water" },
          { text: "Option D (Air answer)", element: "air" },
          { text: "Option E (Light answer)", element: "light" },
          { text: "Option F (Darkness answer)", element: "darkness" }
        ]
      },
      {
        id: 3,
        text: "Placeholder question 3?",
        options: [
          { text: "Option A (Fire answer)", element: "fire" },
          { text: "Option B (Earth answer)", element: "earth" },
          { text: "Option C (Water answer)", element: "water" },
          { text: "Option D (Air answer)", element: "air" },
          { text: "Option E (Light answer)", element: "light" },
          { text: "Option F (Darkness answer)", element: "darkness" }
        ]
      },
      {
        id: 4,
        text: "Placeholder question 4?",
        options: [
          { text: "Option A (Fire answer)", element: "fire" },
          { text: "Option B (Earth answer)", element: "earth" },
          { text: "Option C (Water answer)", element: "water" },
          { text: "Option D (Air answer)", element: "air" },
          { text: "Option E (Light answer)", element: "light" },
          { text: "Option F (Darkness answer)", element: "darkness" }
        ]
      },
      {
        id: 5,
        text: "Placeholder question 5?",
        options: [
          { text: "Option A (Fire answer)", element: "fire" },
          { text: "Option B (Earth answer)", element: "earth" },
          { text: "Option C (Water answer)", element: "water" },
          { text: "Option D (Air answer)", element: "air" },
          { text: "Option E (Light answer)", element: "light" },
          { text: "Option F (Darkness answer)", element: "darkness" }
        ]
      },
      {
        id: 6,
        text: "Placeholder question 6?",
        options: [
          { text: "Option A (Fire answer)", element: "fire" },
          { text: "Option B (Earth answer)", element: "earth" },
          { text: "Option C (Water answer)", element: "water" },
          { text: "Option D (Air answer)", element: "air" },
          { text: "Option E (Light answer)", element: "light" },
          { text: "Option F (Darkness answer)", element: "darkness" }
        ]
      },
      {
        id: 7,
        text: "Placeholder question 7?",
        options: [
          { text: "Option A (Fire answer)", element: "fire" },
          { text: "Option B (Earth answer)", element: "earth" },
          { text: "Option C (Water answer)", element: "water" },
          { text: "Option D (Air answer)", element: "air" },
          { text: "Option E (Light answer)", element: "light" },
          { text: "Option F (Darkness answer)", element: "darkness" }
        ]
      },
      {
        id: 8,
        text: "Placeholder question 8?",
        options: [
          { text: "Option A (Fire answer)", element: "fire" },
          { text: "Option B (Earth answer)", element: "earth" },
          { text: "Option C (Water answer)", element: "water" },
          { text: "Option D (Air answer)", element: "air" },
          { text: "Option E (Light answer)", element: "light" },
          { text: "Option F (Darkness answer)", element: "darkness" }
        ]
      },
      {
        id: 9,
        text: "Placeholder question 9?",
        options: [
          { text: "Option A (Fire answer)", element: "fire" },
          { text: "Option B (Earth answer)", element: "earth" },
          { text: "Option C (Water answer)", element: "water" },
          { text: "Option D (Air answer)", element: "air" },
          { text: "Option E (Light answer)", element: "light" },
          { text: "Option F (Darkness answer)", element: "darkness" }
        ]
      },
      {
        id: 10,
        text: "Placeholder question 10?",
        options: [
          { text: "Option A (Fire answer)", element: "fire" },
          { text: "Option B (Earth answer)", element: "earth" },
          { text: "Option C (Water answer)", element: "water" },
          { text: "Option D (Air answer)", element: "air" },
          { text: "Option E (Light answer)", element: "light" },
          { text: "Option F (Darkness answer)", element: "darkness" }
        ]
      },
      {
        id: 11,
        text: "Placeholder question 11?",
        options: [
          { text: "Option A (Fire answer)", element: "fire" },
          { text: "Option B (Earth answer)", element: "earth" },
          { text: "Option C (Water answer)", element: "water" },
          { text: "Option D (Air answer)", element: "air" },
          { text: "Option E (Light answer)", element: "light" },
          { text: "Option F (Darkness answer)", element: "darkness" }
        ]
      },
      {
        id: 12,
        text: "Placeholder question 12?",
        options: [
          { text: "Option A (Fire answer)", element: "fire" },
          { text: "Option B (Earth answer)", element: "earth" },
          { text: "Option C (Water answer)", element: "water" },
          { text: "Option D (Air answer)", element: "air" },
          { text: "Option E (Light answer)", element: "light" },
          { text: "Option F (Darkness answer)", element: "darkness" }
        ]
      },
      {
        id: 13,
        text: "Placeholder question 13?",
        options: [
          { text: "Option A (Fire answer)", element: "fire" },
          { text: "Option B (Earth answer)", element: "earth" },
          { text: "Option C (Water answer)", element: "water" },
          { text: "Option D (Air answer)", element: "air" },
          { text: "Option E (Light answer)", element: "light" },
          { text: "Option F (Darkness answer)", element: "darkness" }
        ]
      },
      {
        id: 14,
        text: "Placeholder question 14?",
        options: [
          { text: "Option A (Fire answer)", element: "fire" },
          { text: "Option B (Earth answer)", element: "earth" },
          { text: "Option C (Water answer)", element: "water" },
          { text: "Option D (Air answer)", element: "air" },
          { text: "Option E (Light answer)", element: "light" },
          { text: "Option F (Darkness answer)", element: "darkness" }
        ]
      },
      {
        id: 15,
        text: "Placeholder question 15 (TIEBREAKER)?",
        options: [
          { text: "Option A (Fire answer)", element: "fire" },
          { text: "Option B (Earth answer)", element: "earth" },
          { text: "Option C (Water answer)", element: "water" },
          { text: "Option D (Air answer)", element: "air" },
          { text: "Option E (Light answer)", element: "light" },
          { text: "Option F (Darkness answer)", element: "darkness" }
        ]
      },
      {
        id: 16,
        text: "Placeholder question 16?",
        options: [
          { text: "Option A (Fire answer)", element: "fire" },
          { text: "Option B (Earth answer)", element: "earth" },
          { text: "Option C (Water answer)", element: "water" },
          { text: "Option D (Air answer)", element: "air" },
          { text: "Option E (Light answer)", element: "light" },
          { text: "Option F (Darkness answer)", element: "darkness" }
        ]
      }
    ];

    // Element descriptions - placeholder text
    const elementDescriptions = {
      fire: "Placeholder description for Fire element. You are passionate, bold, and driven!",
      earth: "Placeholder description for Earth element. You are grounded, reliable, and steadfast!",
      water: "Placeholder description for Water element. You are adaptable, intuitive, and calm!",
      air: "Placeholder description for Air element. You are free-spirited, curious, and intellectual!",
      light: "Placeholder description for Light element. You are optimistic, pure-hearted, and inspiring!",
      darkness: "Placeholder description for Darkness element. You are mysterious, deep, and introspective!"
    };

    // State
    let currentQuestion = 0;
    let answers = {};

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      generateQuestions();
      setupEventListeners();
    });

    function generateQuestions() {
      const container = document.getElementById('questions-container');

      questions.forEach((q, index) => {
        const questionCard = document.createElement('div');
        questionCard.className = `question-card ${index === 0 ? 'active' : ''}`;
        questionCard.id = `question-${index}`;

        let optionsHTML = '';
        q.options.forEach((opt, optIndex) => {
          optionsHTML += `
            <button class="option-btn" data-question="${index}" data-element="${opt.element}" data-option="${optIndex}">
              ${opt.text}
            </button>
          `;
        });

        questionCard.innerHTML = `
          <div class="question-number">Question ${q.id} of ${questions.length}</div>
          <div class="question-text">${q.text}</div>
          <div class="options-container">
            ${optionsHTML}
          </div>
        `;

        container.appendChild(questionCard);
      });
    }

    function setupEventListeners() {
      // Start button
      document.getElementById('start-btn').addEventListener('click', startQuiz);

      // Option buttons
      document.querySelectorAll('.option-btn').forEach(btn => {
        btn.addEventListener('click', selectOption);
      });

      // Navigation buttons
      document.getElementById('prev-btn').addEventListener('click', prevQuestion);
      document.getElementById('next-btn').addEventListener('click', nextQuestion);

      // Restart button
      document.getElementById('restart-btn').addEventListener('click', restartQuiz);
    }

    function startQuiz() {
      document.getElementById('intro-section').style.display = 'none';
      document.getElementById('quiz-container').style.display = 'block';
      updateProgressBar();
    }

    function selectOption(e) {
      const btn = e.target;
      const questionIndex = parseInt(btn.dataset.question);
      const element = btn.dataset.element;

      // Remove selected class from all options in this question
      document.querySelectorAll(`#question-${questionIndex} .option-btn`).forEach(b => {
        b.classList.remove('selected');
      });

      // Add selected class to clicked option
      btn.classList.add('selected');

      // Store the answer
      answers[questionIndex] = element;

      // Enable next button
      document.getElementById('next-btn').disabled = false;
    }

    function prevQuestion() {
      if (currentQuestion > 0) {
        showQuestion(currentQuestion - 1);
      }
    }

    function nextQuestion() {
      if (currentQuestion < questions.length - 1) {
        showQuestion(currentQuestion + 1);
      } else {
        showResults();
      }
    }

    function showQuestion(index) {
      document.getElementById(`question-${currentQuestion}`).classList.remove('active');
      document.getElementById(`question-${index}`).classList.add('active');
      currentQuestion = index;

      // Update navigation buttons
      document.getElementById('prev-btn').disabled = currentQuestion === 0;
      document.getElementById('next-btn').disabled = answers[currentQuestion] === undefined;

      // Update next button text for last question
      if (currentQuestion === questions.length - 1) {
        document.getElementById('next-btn').textContent = 'See Results';
      } else {
        document.getElementById('next-btn').textContent = 'Next';
      }

      updateProgressBar();
    }

    function updateProgressBar() {
      const progress = ((currentQuestion + 1) / questions.length) * 100;
      const progressBar = document.querySelector('.progress-bar');
      progressBar.style.width = `${progress}%`;
      progressBar.setAttribute('aria-valuenow', progress);
    }

    function calculateResults() {
      // Initialize scores for each element
      const scores = {
        fire: 0,
        earth: 0,
        water: 0,
        air: 0,
        light: 0,
        darkness: 0
      };

      // Calculate weighted scores
      for (let questionIndex in answers) {
        const element = answers[questionIndex];
        const questionId = questions[questionIndex].id;
        const weight = questionWeights[questionId];
        scores[element] += weight;
      }

      return scores;
    }

    function determineWinner(scores) {
      // Find the maximum score
      const maxScore = Math.max(...Object.values(scores));

      // Find all elements with the maximum score
      const topElements = Object.keys(scores).filter(el => scores[el] === maxScore);

      // If there's only one winner, return it
      if (topElements.length === 1) {
        return topElements[0];
      }

      // Tiebreaker: use the answer from question 15
      // Find the index of question 15 in our questions array
      const tiebreakerIndex = questions.findIndex(q => q.id === tiebreakerQuestion);
      if (tiebreakerIndex !== -1 && answers[tiebreakerIndex] !== undefined) {
        const tiebreakerElement = answers[tiebreakerIndex];
        // If the tiebreaker element is among the tied elements, use it
        if (topElements.includes(tiebreakerElement)) {
          return tiebreakerElement;
        }
      }

      // If tiebreaker doesn't resolve it, return the first one alphabetically
      return topElements.sort()[0];
    }

    function showResults() {
      document.getElementById('quiz-container').style.display = 'none';
      document.getElementById('result-container').classList.add('active');

      const scores = calculateResults();
      const winner = determineWinner(scores);
      const maxPossibleScore = Object.values(questionWeights).reduce((a, b) => a + b, 0);

      // Display the winning element
      const resultElement = document.getElementById('result-element');
      resultElement.textContent = winner.charAt(0).toUpperCase() + winner.slice(1);
      resultElement.className = `element-result element-${winner}`;

      // Add result card styling
      const resultCard = document.getElementById('result-card');
      resultCard.className = `result-card ${winner}`;

      // Display description
      document.getElementById('result-description').textContent = elementDescriptions[winner];

      // Display score breakdown with visual bars
      const scoreDetails = document.getElementById('score-details');
      scoreDetails.innerHTML = '';

      // Sort scores from highest to lowest
      const sortedScores = Object.entries(scores).sort((a, b) => b[1] - a[1]);
      const highestScore = sortedScores[0][1];

      sortedScores.forEach(([element, score]) => {
        const percentage = highestScore > 0 ? (score / highestScore) * 100 : 0;
        const row = document.createElement('div');
        row.className = 'score-row';
        row.innerHTML = `
          <span class="element-${element}">${element.charAt(0).toUpperCase() + element.slice(1)}</span>
          <div class="score-bar-container">
            <div class="score-bar ${element}" style="width: ${percentage}%"></div>
          </div>
          <span>${score} pts</span>
        `;
        scoreDetails.appendChild(row);
      });
    }

    function restartQuiz() {
      // Reset state
      currentQuestion = 0;
      answers = {};

      // Reset UI
      document.querySelectorAll('.option-btn').forEach(btn => {
        btn.classList.remove('selected');
      });

      document.querySelectorAll('.question-card').forEach((card, index) => {
        card.classList.toggle('active', index === 0);
      });

      document.getElementById('result-container').classList.remove('active');
      document.getElementById('intro-section').style.display = 'block';
      document.getElementById('quiz-container').style.display = 'none';

      document.getElementById('prev-btn').disabled = true;
      document.getElementById('next-btn').disabled = true;
      document.getElementById('next-btn').textContent = 'Next';

      updateProgressBar();
    }
  </script>

</body>
</html>
